@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

<div ng-controller="Item_Attribute" style="padding:100px 0px">
    <div class="content-wrapper" style="padding-bottom: 80px;">
        <!-- Start content wrapper-->
        <div class="container">
            <!-- Start Container -->
            <div class="row">
                <!-- Start Row -->
                <div class="col-sm-5 detail-content-left">
                    <!-- Start content-left -->
                    <!--<img src="images/3dimage/1.jpg" id="product-image-3d" class="img-fluid" style="margin-bottom:10px;">
                    <div id="slider-range-min"></div>-->
                    <button type="button" class="btn btn-primary btn-360" data-toggle="modal" data-target="#imgModal">
                        <img src="~/images/icons/360-icon-1.jpg" />
                        <img class="img-fluid" src="~/images/3dimage/{{name[0].item.img}}" />
                    </button>

                    <!-- The Modal -->
                    <div class="modal fade" id="imgModal">
                        <div class="modal-dialog modal-full">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">3D</h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>

                                <!-- Modal body -->
                                <div class="modal-body">
                                    <div class="img-container">
                                        <div class="img360">
                                            <img id="myImg" class="img-fluid" src="~/images/3dimage/{{name[0].item.img}}" />
                                        </div>
                                    </div>
                                    <div id="preload-imgs"></div>
                                </div>

                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal"> {{'CLOSE'| translate}}</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> <!-- End content-left-->

                <div class="col-sm-7 detail-content-right">
                    <!-- Start content-right -->

                    <div class="detail-content-right-first">
                        <!-- Start right-first -->
                        <h6>{{name[0].brand_name}}</h6>
                        <h3>{{name[0].item.name}} <i data-toggle="modal" data-target="#followingModal" style="color:#808080; cursor:pointer" class="fas fa-heart"></i></h3>
                        <div class="modal fade" id="followingModal">
                            <div class="modal-dialog">
                                <div class="modal-content">

                                    <!-- Modal Header -->
                                    <div class="modal-header">
                                        <h4 class="modal-title"> {{'FOLLOWING'| translate}}</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    </div>

                                    <!-- Modal body -->
                                    <div class="modal-body">
                                        <div class="detail-second-left">
                                            <!-- Start second-left -->
                                            @{ foreach (var item in ViewBag.dsSize)
                                                {
                                                    <div class="size-wrapper">
                                                        <label for="follow" class="size-label">
                                                            <div class="size-left is-following" ng-click="Click(@item.VN)">
                                                                @item.VN
                                                            </div>
                                                        </label>
                                                    </div>
                                                }
                                            }
                                        </div> <!-- End second-left -->
                                    </div>

                                    @*<div class="modal-footer">
                                            <button class="btn" style="background-color:#0E5396; color:white">
                                                Confirm
                                            </button>
                                        </div>*@
                                </div>
                            </div>
                        </div>
                        @*<p>Condition <span>New</span></p>
                            <h5>100% Authentic</h5>*@
                    </div> <!-- End right-first -->


                    <div class="detail-content-right-second">
                        <!-- Start right-second -->
                        <div class="size">
                            <a style="cursor:pointer; color:aliceblue; font-size:22px" data-toggle="modal" data-target="#sizeModal" class="btn btn-info">{{'SIZE'| translate}}</a> <span style="color:black">&nbsp;<input id="sizeVN" type="number" value="@ViewBag.SizeVN" style="width:80px; border:none; background-color:#FFF" disabled /></span>
                        </div>
                        <div class="modal fade" id="sizeModal">
                            <div class="modal-dialog">
                                <div class="modal-content">

                                    <!-- Modal Header -->
                                    <div class="modal-header">
                                        <h4 class="modal-title">{{'CHOOSESIZE'| translate}}</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    </div>

                                    <!-- Modal body -->
                                    <div class="modal-body">
                                        <div class="detail-second-left">
                                            <!-- Start second-left -->
                                            @{ var i = 0;
                                                foreach (var item in ViewBag.dsSize)
                                                {
                                                    <div class="size-wrapper">
                                                        <input class="d-none" id="size" name="size" type="radio" />
                                                        <label for="size" class="size-label">
                                                            <div class="size-left">
                                                                <input ng-click="btn_size(@item.VN)" type="button" value="@item.VN" style="background-color:#0e5396; color:#FFF; border:none" />
                                                            </div>
                                                            @if (ViewBag.Sizes.Count > i && ViewBag.Sizes[i].id_ds_size == item.id)
                                                            {
                                                                @*<div class="size-right">
                                                                    @ViewBag.Sizes[i++].lowest_ask VND
                                                                </div>*@
                                                            }
                                                        </label>
                                                    </div>
                                                }
                                            }
                                        </div> <!-- End second-left -->
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="detail-second-right" style="display: flex;">
                            <!-- Start second-right -->
                            <div><p>{{'LASTSALE'| translate}}<br> <h3>{{lastsale | currency:"":0:3}} VND</h3></p></div>
                            @*<div><h6>▲+20.000VND(20%)</h6></div>*@

                        </div> <!-- End second-right -->

                    </div> <!-- End right-second -->

                    <div class="detail-content-right-final">
                        <!-- Start right-final -->
                        <div class="float-right detail-right">
                            <h3 style="color: #0E5396; font-weight: bold;">{{name[0].size.lowest_ask | currency:"":0:3}} VND</h3>
                            @*<p style="color: black; transform: translateY(-7px)">View All Asks</p>*@
                        </div>
                        <a ng-click="check_buy()" style="cursor:pointer">
                            <div class="detail-left">
                                <h3 style=" font-family: coolrg;">{{'BUY'| translate}}</h3>
                                <span style="font-family: coolcond; font-size:20px;">{{'LOWESTASK'| translate}}</span>
                            </div>
                        </a>
                    </div>
                    <div class="detail-content-right-final" style="border:1px solid #ab1113">
                        <div class="float-right detail-right">
                            <h3 style="color: brown; font-weight: bold; ">{{name[0].size.highest_bid | currency:"":0:3}} VND</h3>
                            @*<p style="color: black; transform: translateY(-7px)">View All Bids</p>*@
                        </div>
                        <a ng-click="check_sell()" style="cursor:pointer">
                            <div class="detail-left" style="background-color: #ab1113">
                                <h3 style=" font-family: coolrg;">{{'SELL'| translate}}</h3>
                                <span style="font-family: coolcond;font-size:20px">{{'HIGHESTBID'| translate}}</span>
                            </div>
                        </a>
                    </div> <!-- End right-final -->

                </div> <!-- End content-right -->

            </div> <!-- End Row -->
        </div> <!-- End Container -->
    </div> <!-- End content wrapper-->



    <div class="jumbotron">
        <!-- Start Jumbotron -->
        <div class="container">
            <!-- Start container -->
            <div class="row">
                <!-- Start Row -->
                @*<div class="col-sm-4">
                    <h3>{{'DETAIL'| translate}}</h3>
                    <p style="margin-bottom: 0">Style: XXX-XXX</p>
                    <p style="margin-bottom: 0">Colour:Blue</p>
                    <p style="margin-bottom: 0">Retail Price:100.000VND</p>
                    <p style="margin-bottom: 0">Release Date:2019-04-12</p>
                </div>*@
                <div class="col-sm-8">
                    <h3>{{'DESCR'| translate}}</h3>
                    <p ng-bind-html="trustAsHtml(name[0].item.vi_info)">
                    </p>
                </div>
            </div> <!-- End Row -->
        </div> <!-- End container -->
    </div> <!-- End Jumbotron -->
</div>

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.19/jquery.touchSwipe.min.js"></script>
    <script src="~/js/image-360.js"></script>
    <script>
        //Items Attribute
        exaxxiApp.controller('Item_Attribute', function ($scope, $http) {

            var sizeVN = $("#sizeVN").val();

            $http.get("/api/ItemsAPI/Detail/" + @ViewBag.IdItem + "/" + sizeVN)
                .then(function (response) {
                $scope.name = response.data;
                    $http.get("/api/OrdersAPI/TakeLastSale/"+@ViewBag.IdItem)
                    .then(function (response) { $scope.lastsale = response.data;});
                });
            
            $scope.check_buy = function () {
                $http.get("/Login/Check").then(function (rs) {

                    if (rs.data == true) {
                        window.location.href = "/Product/Checkout?id=" +@ViewBag.IdItem + "&size=" + @ViewBag.SizeVN;
                    }
                    else {
                        sessionStorage.setItem('url', location.href);
                        window.open("/Login");
                    }
                });
            };

            $scope.check_sell = function () {
                $http.get("/Login/Check").then(function (rs) {

                    if (rs.data == true) {
                        window.location.href = "/Product/Sell?id=" +@ViewBag.IdItem + "&size=" + @ViewBag.SizeVN;
                    }
                    else {
                        sessionStorage.setItem('url', location.href);
                        window.open("/Login");
                    }
                });
            };

            $scope.Click = function (follow) {
                $http.get("/api/FollowingsAPI/SaveFollowing/" + follow + "/" +@ViewBag.IdItem)
                    .then(function () { alert("This size is followed"); location.reload(); })
                    .catch(function onError(response) {
                        alert(response.data);
                    });
            }

            $scope.btn_size = function (vn) {
                $http.get("/api/ItemsAPI/Detail/" + @ViewBag.IdItem + "/" + vn)
                    .then(function (response) { window.location = "/Product/Details?id=" + @ViewBag.IdItem + "&size=" + vn; });
            };
        });

    </script>
}