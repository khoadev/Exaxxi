
@{
    ViewData["Title"] = "Items";
}
<div class="row" ng-controller="item">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header card-header-primary">
                <h4 class="card-title ">Danh sách sản phẩm</h4>
                <p class="card-category"></p>
            </div>
            <div class="card-body">
                <label for="singleSelect"> sắp xếp: </label><br>
                <select name="singleSelect" data-ng-init="confirmed" ng-change="change()" id="select" ng-model="confirmed">
                    <option value="">all</option>
                    <option ng-repeat="x in name" value="{{x.id}}">{{x.name}}</option>

                </select>
                <div class="table-responsive">
                    <table class="table">
                        <thead class=" text-primary">
                            <tr>
                                <th ng-click='sortColumn("items.name")' ng-class='sortClass("name")'>
                                    Tên sản phẩm
                                </th>
                                <th>
                                    Hình
                                </th>
                                <th ng-click='sortColumn("items.lowest_ask")' ng-class='sortClass("lowest_ask")'>
                                    Giá
                                </th>
                                <th>
                                    Biến động giá
                                </th>
                                <th>
                                    active
                                </th>
                                <th>
                                    sold
                                </th>
                                <th>
                                    admin
                                </th>
                                <th>
                                    category
                                </th>
                                <th><a asp-action="Create">Thêm</a></th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr dir-paginate="x in getItem | itemsPerPage: 5 |  orderBy:column:reverse">
                                <td>
                                    {{x.items.name}}
                                </td>

                                <td>
                                    <img src="~/images/item/{{x.items.img}}" width="20" height="100" />

                                </td>
                                <td>
                                    {{x.items.lowest_ask}}

                                </td>
                                <td>
                                    {{x.items.volatility}}

                                </td>
                                <td>
                                    {{x.items.active}}

                                </td>
                                <td>
                                    {{x.items.sold}}

                                </td>
                                <td>
                                    {{x.nameAdmin}}

                                </td>
                                <td>
                                    {{x.nameCate}}

                                </td>
                                <td>
                                    <a href="/Admin/Items/Edit/{{x.items.id}}">Edit</a> |
                                    <a href="/Admin/Items/Details/{{x.items.id}}">Details</a> |
                                    <a style="cursor: pointer;" id="delete" class="delete" ng-click="Delete(x.items.id)">Delete</a>
                                </td>

                        </tbody>
                    </table>

                </div>
                <div class="pagination-wrapper row">
                    <dir-pagination-controls boundary-links="true" template-url="../dirPagination.tpl.html"></dir-pagination-controls>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>

        app.controller('item', function ($scope, $http) {
            $scope.Delete = function (id) {
                var url = '/api/ItemsChange/' + id;
                //  $http.defaults.headers.common.Authorization = 'Bearer ' + sessionStorage.getItem('token');
                var config = {
                    headers: {
                        'Context-Type': 'application/json',
                        'Authorization': 'Bearer ' + sessionStorage.getItem('token')
                    }
                }
                var isConfirm = confirm("bạn có chắc chắn muốn xóa")
                if (isConfirm) {
                    $http.delete(url, config).then(function (response) {
                        window.location.reload();
                    });

                } else {
                    return false;
                }
            }
            // column to sort
            $scope.column = 'items.lowest_ask';

            // sort ordering (Ascending or Descending). Set true for desending
            $scope.reverse = false;

            // called on header click
            $scope.sortColumn = function (col) {
                $scope.column = col;
                if ($scope.reverse) {
                    $scope.reverse = false;
                    $scope.reverseclass = 'arrow-up';
                } else {
                    $scope.reverse = true;
                    $scope.reverseclass = 'arrow-down';
                }
            };

            // remove and change class
            $scope.sortClass = function (col) {
                if ($scope.column == col) {
                    if ($scope.reverse) {
                        return 'arrow-down';
                    } else {
                        return 'arrow-up';
                    }
                } else {
                    return '';
                }
            }
            $http.get("/api/CategoriesAPI")
                .then(function (response) { $scope.name = response.data; });
            $http.get("/api/ItemsAPI/GetItemsAd/" + 0)
                .then(function (response) { $scope.getItem = response.data;  });
          
            $scope.change = function () {
                
                   if ($("#select").val() != null) {
                       x = $("#select").val();
                   }
                    $http.get("/api/ItemsAPI/GetItemsAd/" + x)
                        .then(function (response) { $scope.getItem = response.data;});
                }
            });
       
    </script>
}
